<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Respostas do formulário" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
  <div class="col-lg-12">
      <div class="card">
          <div class="card-header">
            <div class="container">
              <div class="row">
                <div class="col">
                  <h4 class="card-title flex-grow-1 mb-2">
                    {{form?.title}}
                  </h4>
                  <h4 class="card-title flex-grow-1 mb-2">
                    Listagem de respostas
                  </h4>
                </div>
                <!-- <div class="col">
                  <div class="float-end">
                    <a href="/cadastro/formularios/cadastrar" class="btn btn-primary waves-effect waves-light">
                      <i class="ri-add-line align-middle me-2"></i> Cadastrar Formulário
                    </a>
                  </div>
                </div> -->
              </div>
            </div>
          </div>

          <div class="card-body">

            <div class="progress" *ngIf="loading">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
            </div>&nbsp;

            <div>
              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  role="switch"
                  [(ngModel)]="showValues"
                />
                <label
                  class="form-check-label"
                >
                  Exibir valores respondidos
                </label>
              </div>
            </div>

            <div class="table-responsive mt-1">
              <table class="table table-gridjs">
                <thead>
                <tr>
                  <th class="sort">Respondido por</th>
                  <th class="sort">Respondido em</th>
                  <th class="sort">Conformidade</th>
                  @if (showValues) {
                    @for (component of form.components; track component.id) {
                      <th class="sort bg-primary text-light">{{component.title}}</th>
                    }
                  }
                  <th>Ações</th>
                </tr>
                </thead>
                <tbody>
                  @for(data of items;track $index){
                <tr>
                  <td><ngb-highlight [result]="data.technician.name" [term]="search"></ngb-highlight></td>
                  <td><ngb-highlight [result]="data.createdAt | date" [term]="search"></ngb-highlight></td>
                  <td>
                    <span class="badge" style="font-size: 1em;" [ngClass]="{'bg-success': data.accordingly, 'bg-danger': !data.accordingly}">
                      <ngb-highlight [result]="data.accordingly ? 'Sim' : 'Não'" [term]="search"></ngb-highlight>
                    </span>
                  </td>

                  @if (showValues) {
                    @for (component of form.components; track component.id) {
                      <td>
                        {{getExecutionDisplay(component, data)}}
                        @if (!getExecutionValue(component, data).accordingly) {
                          <span class="text-danger">
                            <i class="ri-error-warning-fill"></i>
                          </span>
                        }
                      </td>
                    }
                  }

                  <td data-column-id="actions" class="gridjs-td">
                    <div class="d-flex gap-2">
                      <!-- Botão Editar -->
                      <a
                        (click)="viewExecution(data)"
                        class="btn btn-icon btn-sm btn-ghost-info"
                        title="Ver respostas"
                      >
                        <!-- fs-5 faz o ícone ser 1.25rem -->
                        <!-- Você pode usar fs-4 (1.5rem), fs-3 (1.75rem), etc. conforme desejar -->
                        <i class="ri-eye-line align-bottom fs-5"></i>
                      </a>
                  
                      <!-- Botão Excluir -->
                      <button
                        (click)="delete(data.id)"
                        class="btn btn-icon btn-sm btn-ghost-danger"
                        title="Excluir"
                      >
                        <i class="ri-delete-bin-line align-bottom fs-5"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
                </tbody>
              </table>
            </div>
            <div class="row justify-content-md-between align-items-md-center">
              <div class="col-sm-12 col-md-5">
                  <div class="dataTables_info mb-2" id="tickets-table_info" role="status" aria-live="polite">
                      Página {{page}} de {{total ? (total / pageSize) : 1}}
                  </div>
              </div>
              <!-- Pagination -->
              <div class="col-sm-12 col-md-5">
                  <div class="text-md-right float-md-end gridjs-pagination">
                    <ngb-pagination
                    [collectionSize]="total" [(page)]="page" [pageSize]="pageSize">
                  </ngb-pagination>
                  </div>
              </div>
              <!-- End Pagination -->
            </div>
          </div><!-- end card-body -->
      </div><!-- end card -->
  </div>
  <!-- end col -->
</div>
<!-- end row -->

